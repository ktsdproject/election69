<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Election Quest Map</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Mali:wght@400;600;700&family=Sarabun:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* --- CORE SCALING STYLES (‡∏¢‡∏Å‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏ï‡πâ‡∏ô‡πÅ‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì) --- */
        html {
            /* font-size ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÇ‡∏î‡∏¢ JS adjustmentGameScaling */
        }
        body {
            font-family: 'Mali', cursive; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏´‡πâ‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å */
            background-color: #202020;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }
        .game-frame {
            position: relative;
            overflow: hidden;
            background-color: #ffffff;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            width: 95vw;
            height: calc(95vw * 1708 / 960);
            max-width: 500px; /* ‡∏õ‡∏£‡∏±‡∏ö max-width ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö Maps */
            max-height: 890px;
            margin: auto;
            border-radius: 2rem; /* ‡∏°‡∏∏‡∏°‡πÇ‡∏Ñ‡πâ‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
        }
        /* ‡∏ñ‡πâ‡∏≤‡∏à‡∏≠‡∏™‡∏π‡∏á ‡πÉ‡∏´‡πâ‡∏¢‡∏∂‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å */
        @media (min-aspect-ratio: 960/1708) {
            .game-frame {
                height: 90vh;
                width: calc(90vh * 960 / 1708);
            }
        }

        /* --- SCREEN MANAGEMENT --- */
        .game-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            opacity: 0; visibility: hidden;
            transition: opacity 0.4s ease-in-out;
            background-color: #f0f4f8;
        }
        .game-screen.active {
            opacity: 1; visibility: visible;
        }

        /* --- MAP STYLES --- */
        #map {
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        /* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏õ‡∏∏‡πà‡∏° Zoom ‡∏Ç‡∏≠‡∏á Leaflet ‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ò‡∏µ‡∏° */
        .leaflet-control-zoom {
            border: none !important;
            margin-bottom: 15rem !important; /* ‡∏î‡∏±‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏´‡∏ô‡∏µ UI ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á */
            margin-right: 2rem !important;
        }
        .leaflet-control-zoom a {
            background-color: #FFD700 !important;
            color: #333 !important;
            border-radius: 1rem !important;
            width: 4rem !important;
            height: 4rem !important;
            line-height: 4rem !important;
            font-size: 2.5rem !important;
            box-shadow: 0 0.5rem 0 #cba800 !important;
            margin-bottom: 1rem !important;
        }

        /* --- CUSTOM UI ELEMENTS (REM UNITS) --- */
        .start-btn {
            background-color: #FF6B6B;
            color: white;
            font-size: 3.5rem;
            padding: 1.5rem 4rem;
            border-radius: 5rem;
            border: none;
            box-shadow: 0 0.8rem 0 #D64545;
            cursor: pointer;
            transition: transform 0.1s;
        }
        .start-btn:active {
            transform: translateY(0.5rem);
            box-shadow: 0 0.3rem 0 #D64545;
        }

        /* --- POPUP CARD STYLE --- */
        .info-popup-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            z-index: 1000;
            display: flex; justify-content: center; align-items: flex-end;
            opacity: 0; visibility: hidden;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .info-popup-overlay.visible {
            opacity: 1; visibility: visible;
        }
        .info-card {
            background: white;
            width: 100%;
            height: 75%; /* ‡∏™‡∏π‡∏á 75% ‡∏Ç‡∏≠‡∏á‡∏à‡∏≠ */
            border-radius: 4rem 4rem 0 0;
            padding: 3rem;
            box-sizing: border-box;
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
            display: flex; flex-direction: column;
            position: relative;
        }
        .info-popup-overlay.visible .info-card {
            transform: translateY(0);
        }

        .close-btn {
            position: absolute; top: 2rem; right: 2rem;
            background: #eee; width: 4rem; height: 4rem;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 2rem; color: #555; cursor: pointer;
        }

        /* Gallery Scroll */
        .gallery-scroll {
            display: flex; overflow-x: auto; gap: 1.5rem;
            padding: 1rem 0; margin-top: 2rem;
            scroll-snap-type: x mandatory;
        }
        .gallery-scroll::-webkit-scrollbar { display: none; }
        .gallery-scroll img {
            height: 15rem; width: auto;
            border-radius: 1.5rem;
            scroll-snap-align: start;
            box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.1);
        }

        /* Categories Badge */
        .badge {
            display: inline-block;
            padding: 0.5rem 1.5rem;
            border-radius: 2rem;
            font-size: 1.8rem;
            font-weight: bold;
            margin-right: 1rem;
        }
        .badge-out { background: #FFE5D9; color: #D64545; }
        .badge-in { background: #E3F2FD; color: #1E88E5; }

        /* Filter Tabs */
        .filter-container {
            position: absolute; top: 2rem; left: 0; width: 100%;
            display: flex; justify-content: center; gap: 1rem;
            z-index: 500;
            padding: 0 2rem;
            box-sizing: border-box;
        }
        .filter-btn {
            background: white; border: 2px solid #ddd;
            padding: 0.8rem 1.5rem; border-radius: 2rem;
            font-size: 1.6rem; font-weight: bold; color: #555;
            box-shadow: 0 0.4rem 0.5rem rgba(0,0,0,0.1);
            cursor: pointer;
        }
        .filter-btn.active {
            background: #4ECDC4; border-color: #4ECDC4; color: white;
        }

    </style>
</head>
<body>

    <div class="game-frame">
        
        <div id="start-screen" class="game-screen active" style="background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%); justify-content: center; align-items: center; text-align: center;">
            <div style="font-size: 8rem;">üó≥Ô∏è</div>
            <h1 style="font-size: 5rem; color: #333; margin: 2rem 0;">‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà<br>‡∏à‡∏∏‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á</h1>
            <p style="font-size: 2rem; color: #666; margin-bottom: 5rem;">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ 130 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á<br>‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</p>
            <button class="start-btn" onclick="goToMap()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
        </div>

        <div id="map-screen" class="game-screen">
            <div class="filter-container">
                <button class="filter-btn active" onclick="filterMap('all', this)">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                <button class="filter-btn" onclick="filterMap('out', this)">‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å</button>
                <button class="filter-btn" onclick="filterMap('in', this)">‡∏†‡∏≤‡∏¢‡πÉ‡∏ô</button>
            </div>

            <div id="map"></div>
        </div>

        <div id="info-overlay" class="info-popup-overlay" onclick="closePopup(event)">
            <div class="info-card" onclick="event.stopPropagation()"> <div class="close-btn" onclick="closePopupDirect()">‚úï</div>
                
                <h2 id="p-name" style="font-size: 3rem; font-weight: 700; color: #333; line-height: 1.2;">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</h2>
                <p id="p-sub" style="font-size: 2rem; color: #888; margin-top: 0.5rem;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡πà‡∏≠‡∏¢</p>
                
                <div style="margin-top: 2rem;">
                    <span id="p-type" class="badge badge-out">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</span>
                    <span id="p-unit" style="font-size: 1.8rem; color: #555;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
                </div>

                <div id="p-gallery" class="gallery-scroll"></div>

                <div style="margin-top: 2rem; padding: 2rem; background: #f9f9f9; border-radius: 2rem; border: 2px dashed #ddd;">
                    <p style="font-size: 1.6rem; font-weight: 700; color: #555;">Note:</p>
                    <p id="p-note" style="font-size: 1.8rem; color: #333;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°...</p>
                </div>
            </div>
        </div>

    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // --- 1. CONFIG & DATA ---
        const units = [
            {
                "id": 1,
                "name": "‡∏•‡∏≤‡∏ô‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡∏ï‡∏•‡∏≤‡∏î‡∏¢‡∏≤‡∏™‡∏π‡∏ö",
                "name_details": "‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡πÉ‡∏Å‡∏•‡πâ‡∏™‡∏´‡∏†‡∏≤‡∏û‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô",
                "unit_count": "3 ‡∏´‡∏ô‡πà‡∏ß‡∏¢",
                "lat": 13.724167, "lng": 100.554444,
                "images": ["https://placehold.co/400x300/orange/white?text=Img1", "https://placehold.co/400x300/orange/white?text=Img2"],
                "details_range": "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà 1-3",
                "location_type": "‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£",
                "note": "‡∏à‡∏∏‡∏î‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà"
            },
            {
                "id": 2,
                "name": "‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏±‡∏î‡∏Ñ‡∏•‡∏≠‡∏á‡πÄ‡∏ï‡∏¢",
                "name_details": "‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 1 ‡∏ä‡∏±‡πâ‡∏ô‡∏•‡πà‡∏≤‡∏á",
                "unit_count": "1 ‡∏´‡∏ô‡πà‡∏ß‡∏¢",
                "lat": 13.718500, "lng": 100.559200,
                "images": [],
                "details_range": "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà 4",
                "location_type": "‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£",
                "note": "‡∏ó‡∏≤‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô"
            },
             {
                "id": 3,
                "name": "‡∏ß‡∏±‡∏î‡∏™‡∏∞‡∏û‡∏≤‡∏ô",
                "name_details": "‡∏•‡∏≤‡∏ô‡∏ß‡∏±‡∏î",
                "unit_count": "2 ‡∏´‡∏ô‡πà‡∏ß‡∏¢",
                "lat": 13.710000, "lng": 100.590000,
                "images": ["https://placehold.co/400x300/green/white?text=Map"],
                "details_range": "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà 5-6",
                "location_type": "‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£",
                "note": "-"
            }
        ];

        let map, markers = [];

        // --- 2. SCALING LOGIC (Core Game System) ---
        function adjustGameScaling() {
            const gameFrame = document.querySelector('.game-frame');
            if (!gameFrame) return;

            // Base width is 960 (from your reference code)
            const designWidth = 960;
            const currentWidth = gameFrame.offsetWidth;
            
            // Calculate ratio
            const scaleRatio = currentWidth / designWidth;
            // Set root font size so 1rem scales with the container
            // 10px base * ratio. E.g., if full width, 1rem = 10px.
            const rootFontSize = 10 * scaleRatio; 

            document.documentElement.style.fontSize = `${rootFontSize}px`;
            
            // Invalidate map size if map exists (to fix rendering issues on resize)
            if(map) setTimeout(() => map.invalidateSize(), 300);
        }

        window.addEventListener('load', () => {
            adjustGameScaling();
            initMap(); // ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≠‡πÑ‡∏ß‡πâ‡πÄ‡∏•‡∏¢
        });
        window.addEventListener('resize', adjustGameScaling);

        // --- 3. NAVIGATION ---
        function goToMap() {
            document.getElementById('start-screen').classList.remove('active');
            document.getElementById('map-screen').classList.add('active');
            
            // Leaflet needs a moment to realize container size changed
            setTimeout(() => {
                map.invalidateSize();
            }, 500);
        }

        // --- 4. MAP LOGIC ---
        function initMap() {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
            map = L.map('map', { zoomControl: true }).setView([13.720, 100.555], 14);

            // ‡πÉ‡∏ä‡πâ Tile ‡∏ó‡∏µ‡πà‡∏î‡∏π‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏ï‡∏≤ (CartoDB Positron) ‡∏´‡∏£‡∏∑‡∏≠ OpenStreetMap
            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                attribution: '¬©OpenStreetMap, ¬©CartoDB',
                maxZoom: 19
            }).addTo(map);

            // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏™‡∏£‡πâ‡∏≤‡∏á Marker
            renderMarkers(units);
        }

        function renderMarkers(data) {
            // ‡∏•‡πâ‡∏≤‡∏á Marker ‡πÄ‡∏Å‡πà‡∏≤
            markers.forEach(m => map.removeLayer(m));
            markers = [];

            data.forEach(unit => {
                // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
                let typeColor = unit.location_type.includes("‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å") ? "red" : "blue";
                
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á Custom Icon (Emoji Pin) ‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å
                let customIcon = L.divIcon({
                    className: 'custom-pin',
                    html: `<div style="
                        background-color: ${typeColor === 'red' ? '#FF6B6B' : '#4ECDC4'};
                        width: 3rem; height: 3rem;
                        border-radius: 50%;
                        border: 0.3rem solid white;
                        box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.3);
                        display: flex; justify-content: center; align-items: center;
                        font-size: 1.5rem;
                    ">${typeColor === 'red' ? '‚òÄÔ∏è' : 'üè¢'}</div>`,
                    iconSize: [30, 30],
                    iconAnchor: [15, 15] // ‡∏à‡∏∏‡∏î‡∏ä‡∏µ‡πâ
                });

                let marker = L.marker([unit.lat, unit.lng], { icon: customIcon })
                    .addTo(map)
                    .on('click', () => openPopup(unit));
                
                markers.push(marker);
            });
        }

        // --- 5. POPUP SYSTEM (Overlay) ---
        function openPopup(data) {
            const overlay = document.getElementById('info-overlay');
            
            // ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (DOM Manipulation)
            document.getElementById('p-name').innerText = data.name;
            document.getElementById('p-sub').innerText = data.name_details;
            document.getElementById('p-unit').innerText = data.unit_count;
            document.getElementById('p-note').innerText = data.note;

            // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Badge
            const typeBadge = document.getElementById('p-type');
            if(data.location_type.includes("‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å")) {
                typeBadge.className = "badge badge-out";
                typeBadge.innerText = "‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£";
            } else {
                typeBadge.className = "badge badge-in";
                typeBadge.innerText = "‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£";
            }

            // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Gallery
            const gallery = document.getElementById('p-gallery');
            gallery.innerHTML = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡πÄ‡∏Å‡πà‡∏≤
            
            if (data.images.length > 0) {
                data.images.forEach(img => {
                    gallery.innerHTML += `<img src="${img}" onclick="window.open('${img}')">`;
                });
            } else {
                gallery.innerHTML = `<div style="width:100%; height:10rem; background:#eee; border-radius:1.5rem; display:flex; justify-content:center; align-items:center; color:#999; font-size:1.6rem;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</div>`;
            }

            overlay.classList.add('visible');
        }

        function closePopup(e) {
            // ‡∏ñ‡πâ‡∏≤‡∏Å‡∏î‡∏ó‡∏µ‡πà‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏µ‡∏î‡∏≥ (Overlay) ‡πÉ‡∏´‡πâ‡∏õ‡∏¥‡∏î
            if (e.target.id === 'info-overlay') {
                closePopupDirect();
            }
        }
        
        function closePopupDirect() {
            document.getElementById('info-overlay').classList.remove('visible');
        }

        // --- 6. FILTER SYSTEM ---
        function filterMap(type, btn) {
            // ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° Active
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            if (type === 'all') {
                renderMarkers(units);
            } else if (type === 'out') {
                const filtered = units.filter(u => u.location_type.includes("‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å"));
                renderMarkers(filtered);
            } else if (type === 'in') {
                const filtered = units.filter(u => u.location_type.includes("‡∏†‡∏≤‡∏¢‡πÉ‡∏ô"));
                renderMarkers(filtered);
            }
        }

    </script>
</body>
</html>
