<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Election Quest Map</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Mali:wght@400;600;700&family=Sarabun:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* =========================================
           1. SHARED STYLES (Base)
           ========================================= */
        html { font-size: 10px; } /* Default base size */
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #202020;
            margin: 0;
            overflow: hidden; /* Desktop default, mobile handles differently */
        }
        h1, h2, h3, .nav-tab, .badge, .filter-btn { font-family: 'Mali', cursive; }

        /* =========================================
           2. MOBILE VIEW (Default / App Style)
           - ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏•‡πá‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1024px
           ========================================= */
        .game-frame {
            position: relative; overflow: hidden;
            background-color: #f0f4f8;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            /* Mobile Default Setup */
            width: 95vw; height: calc(95vw * 1708 / 960);
            max-width: 500px; max-height: 890px;
            margin: auto; border-radius: 2rem;
            display: flex; flex-direction: column;
            transform-origin: center top; 
        }

        /* Center the frame on mobile */
        body.mobile-mode {
            display: flex; justify-content: center; align-items: center;
            height: 100vh; overflow: auto;
        }

        /* Top Nav (Tabs) */
        .top-nav {
            flex-shrink: 0; height: 6rem; background: #fff; display: flex;
            box-shadow: 0 0.2rem 0.5rem rgba(0,0,0,0.05); z-index: 100;
        }
        .nav-tab {
            flex: 1; border: none; background: #f4f6f8;
            font-size: 1.8rem; font-weight: bold; color: #888;
            cursor: pointer; position: relative; transition: all 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 0.5rem;
            border-bottom: 0.4rem solid transparent;
        }
        .nav-tab.active { background: #fff; color: #4ECDC4; border-bottom: 0.4rem solid #4ECDC4; }

        /* Content Area & Views */
        .content-area { flex: 1; position: relative; overflow: hidden; display: flex; }
        
        .tab-view {
            width: 100%; height: 100%;
            display: none; flex-direction: column; /* Mobile: Hide by default */
        }
        .tab-view.active { display: flex; } /* Mobile: Show only active */

        /* Timeline Specific */
        #view-timeline { overflow-y: auto; padding: 2rem; background: #fff; }
        .timeline-header { text-align: center; margin-bottom: 3rem; margin-top: 1rem; }
        .timeline-item { display: flex; gap: 1.5rem; position: relative; padding-bottom: 3rem; }
        .timeline-item::before {
            content: ''; position: absolute; left: 1.4rem; top: 3.5rem; bottom: 0;
            width: 0.3rem; background: #e0e0e0; z-index: 0;
        }
        .timeline-item:last-child::before { display: none; }
        .t-circle {
            width: 3.5rem; height: 3.5rem; border-radius: 50%; flex-shrink: 0; z-index: 1;
            display: flex; justify-content: center; align-items: center;
            font-size: 1.8rem; color: white; border: 0.3rem solid white;
            box-shadow: 0 0.3rem 0.5rem rgba(0,0,0,0.1);
        }
        .t-status-done .t-circle { background: #4CAF50; }
        .t-status-active .t-circle { background: #FF9800; animation: pulse 1.5s infinite; }
        .t-status-future .t-circle { background: #ddd; color: #aaa; }
        .t-content h3 { font-size: 1.9rem; font-weight: bold; margin: 0; color: #333; line-height: 1.3; }
        .t-content p { font-size: 1.5rem; color: #666; margin: 0.4rem 0; line-height: 1.4; }
        .t-content .t-date { font-size: 1.4rem; font-weight: 600; color: #888; margin-bottom: 0.5rem; display: block; }
        .t-status-active .t-content h3 { color: #FF9800; }
        
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 152, 0, 0.7); } 70% { box-shadow: 0 0 0 1rem rgba(255, 152, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 152, 0, 0); } }

        /* Map Specific */
        #map { width: 100%; height: 100%; z-index: 1; }
        .filter-container {
            position: absolute; top: 2rem; left: 0; width: 100%;
            display: flex; justify-content: center; gap: 1rem;
            z-index: 500; padding: 0 2rem; box-sizing: border-box; pointer-events: none;
        }
        .filter-btn {
            pointer-events: auto; background: white; border: 0.2rem solid #ddd;
            padding: 0.8rem 1.5rem; border-radius: 2rem; font-size: 1.6rem; font-weight: bold; color: #555;
            box-shadow: 0 0.4rem 0.5rem rgba(0,0,0,0.1); cursor: pointer;
        }
        .filter-btn.active { background: #4ECDC4; border-color: #4ECDC4; color: white; }
        .leaflet-control-zoom a {
            background-color: #FFD700 !important; color: #333 !important;
            border-radius: 1rem !important; width: 4rem !important; height: 4rem !important;
            line-height: 4rem !important; font-size: 2.5rem !important;
        }

        /* Popup */
        .info-popup-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
            z-index: 1000; display: flex; justify-content: center; align-items: flex-end;
            opacity: 0; visibility: hidden; transition: all 0.3s;
        }
        .info-popup-overlay.visible { opacity: 1; visibility: visible; }
        .info-card {
            background: white; width: 100%; height: 75%;
            border-radius: 4rem 4rem 0 0; padding: 3rem;
            transform: translateY(100%); transition: transform 0.3s ease-out;
            display: flex; flex-direction: column; position: relative;
        }
        .info-popup-overlay.visible .info-card { transform: translateY(0); }
        .close-btn-circle { position: absolute; top: 2rem; right: 2rem; background: #eee; width: 4rem; height: 4rem; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; cursor: pointer; }
        .gallery-scroll { display: flex; overflow-x: auto; gap: 1.5rem; padding: 1rem 0; margin-top: 2rem; }
        .gallery-scroll img { height: 15rem; width: auto; border-radius: 1.5rem; box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.1); }
        .badge { display: inline-block; padding: 0.5rem 1.5rem; border-radius: 2rem; font-size: 1.8rem; font-weight: bold; margin-right: 1rem; }
        .badge-out { background: #FFE5D9; color: #D64545; }
        .badge-in { background: #E3F2FD; color: #1E88E5; }

        /* =========================================
           3. DESKTOP / TABLET LANDSCAPE (>1024px)
           - ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å layout ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠
           - ‡∏ã‡πâ‡∏≤‡∏¢: Timeline, ‡∏Ç‡∏ß‡∏≤: Map
           ========================================= */
        @media (min-width: 1024px) {
            body { 
                overflow: hidden; /* Desktop ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á Scroll body ‡∏´‡∏•‡∏±‡∏Å */
                background-color: #f0f4f8; /* Background ‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ */
            }
            
            .game-frame {
                /* Reset Mobile Constraints */
                width: 100vw; height: 100vh;
                max-width: none; max-height: none;
                margin: 0; border-radius: 0;
                box-shadow: none;
            }

            .top-nav { display: none; } /* ‡∏ã‡πà‡∏≠‡∏ô Tab Bar ‡∏ö‡∏ô Desktop */

            .content-area {
                flex-direction: row; /* ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô */
            }

            /* --- Left Panel: Timeline --- */
            #view-timeline {
                display: block !important; /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÇ‡∏ä‡∏ß‡πå‡∏ï‡∏•‡∏≠‡∏î */
                width: 35%; /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á Timeline */
                min-width: 350px;
                max-width: 500px;
                border-right: 1px solid #ddd;
                height: 100%;
                z-index: 2;
                box-shadow: 2px 0 10px rgba(0,0,0,0.05);
            }
            .mobile-only-btn { display: none; } /* ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏° '‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà' */

            /* --- Right Panel: Map --- */
            #view-map {
                display: block !important; /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÇ‡∏ä‡∏ß‡πå‡∏ï‡∏•‡∏≠‡∏î */
                flex: 1; /* ‡∏Å‡∏¥‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ */
                height: 100%;
                position: relative;
            }

            /* Popup ‡∏ö‡∏ô Desktop ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏¢‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏™‡∏ß‡∏¢‡πÜ */
            .info-card {
                width: 500px; height: auto; max-height: 80vh;
                border-radius: 2rem;
                transform: translateY(20px); opacity: 0;
                box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            }
            .info-popup-overlay { align-items: center; }
            .info-popup-overlay.visible .info-card { transform: translateY(0); opacity: 1; }
        }

    </style>
</head>
<body class="mobile-mode"> <div class="game-frame">
        
        <nav class="top-nav">
            <button class="nav-tab active" onclick="switchTab('timeline', this)">üìÖ ‡πÑ‡∏ó‡∏°‡πå‡πÑ‡∏•‡∏ô‡πå</button>
            <button class="nav-tab" onclick="switchTab('map', this)">üó∫Ô∏è ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</button>
        </nav>

        <div class="content-area">
            
            <div id="view-timeline" class="tab-view active">
                <div class="timeline-header">
                    <h1 style="font-size: 3rem; margin:0; color:#333;">‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á</h1>
                    <p style="font-size: 1.6rem; color:#888;">‡∏û.‡∏®. 2568 - 2569</p>
                </div>
                <div id="timeline-container"></div>
                <button class="mobile-only-btn" onclick="document.querySelectorAll('.nav-tab')[1].click()" 
                    style="width: 100%; font-size: 2rem; padding: 1.5rem; margin-top: 2rem; margin-bottom: 2rem;
                        background: #eee; color: #555; border: none; border-radius: 2rem; font-weight: bold; cursor: pointer; font-family: 'Mali';">
                    ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà üëâ
                </button>
            </div>

            <div id="view-map" class="tab-view">
                <div class="filter-container">
                    <button class="filter-btn active" onclick="filterMap('all', this)">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                    <button class="filter-btn" onclick="filterMap('out', this)">‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å</button>
                    <button class="filter-btn" onclick="filterMap('in', this)">‡∏†‡∏≤‡∏¢‡πÉ‡∏ô</button>
                </div>
                <div id="map"></div>
            </div>

        </div>

        <div id="info-overlay" class="info-popup-overlay" onclick="closePopup(event)">
            <div class="info-card" onclick="event.stopPropagation()">
                <div class="close-btn-circle" onclick="closePopupDirect()">‚úï</div>
                <h2 id="p-name" style="font-size: 3rem; font-weight: 700; color: #333; line-height: 1.2;">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</h2>
                <p id="p-sub" style="font-size: 2rem; color: #888; margin-top: 0.5rem;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡πà‡∏≠‡∏¢</p>
                <div style="margin-top: 2rem;">
                    <span id="p-type" class="badge badge-out">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</span>
                    <span id="p-unit" style="font-size: 1.8rem; color: #555;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
                </div>
                <div id="p-gallery" class="gallery-scroll"></div>
                <div style="margin-top: 2rem; padding: 2rem; background: #f9f9f9; border-radius: 2rem; border: 2px dashed #ddd;">
                    <p style="font-size: 1.6rem; font-weight: 700; color: #555;">Note:</p>
                    <p id="p-note" style="font-size: 1.8rem; color: #333;">-</p>
                </div>
            </div>
        </div>

    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // --- DATA SECTION ---
        const timelineData = [
            { dateText: "12 ‡∏ò.‡∏Ñ. 68", title: "‡∏û.‡∏£.‡∏é.‡∏¢‡∏∏‡∏ö‡∏™‡∏†‡∏≤‡∏Ø ‡∏°‡∏µ‡∏ú‡∏•‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ", desc: "‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏ä‡∏Å‡∏§‡∏©‡∏é‡∏µ‡∏Å‡∏≤‡∏¢‡∏∏‡∏ö‡∏™‡∏†‡∏≤‡∏ú‡∏π‡πâ‡πÅ‡∏ó‡∏ô‡∏£‡∏≤‡∏©‡∏é‡∏£ ‡∏û.‡∏®.2568 ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ‡∏ú‡∏•", startDate: new Date("2025-12-12T00:00:00"), endDate: new Date("2025-12-12T23:59:59") },
            { dateText: "15 ‡∏ò.‡∏Ñ. 68", title: "‡∏Å‡∏Å‡∏ï. ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á", desc: "", startDate: new Date("2025-12-15T00:00:00"), endDate: new Date("2025-12-15T23:59:59") },
            { dateText: "20 ‡∏ò.‡∏Ñ. 68 - 5 ‡∏°.‡∏Ñ. 69", title: "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤", desc: "‡∏ó‡∏±‡πâ‡∏á‡πÉ‡∏ô‡πÄ‡∏Ç‡∏ï ‡∏ô‡∏≠‡∏Å‡πÄ‡∏Ç‡∏ï ‡πÅ‡∏•‡∏∞‡∏ô‡∏≠‡∏Å‡∏£‡∏≤‡∏ä‡∏≠‡∏≤‡∏ì‡∏≤‡∏à‡∏±‡∏Å‡∏£", startDate: new Date("2025-12-20T00:00:00"), endDate: new Date("2026-01-05T23:59:59") },
            { dateText: "27-31 ‡∏ò.‡∏Ñ. 68", title: "‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£ ‡∏™‡∏™. ‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏Ç‡∏ï", desc: "‡πÄ‡∏ß‡∏•‡∏≤ 08.30-16.30 ‡∏ô. ‡∏ì ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏Ç‡∏ï‡∏Å‡∏≥‡∏´‡∏ô‡∏î", startDate: new Date("2025-12-27T08:30:00"), endDate: new Date("2025-12-31T16:30:00") },
            { dateText: "28-31 ‡∏ò.‡∏Ñ. 68", title: "‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£ ‡∏™‡∏™. ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠", desc: "‡∏ì ‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏≤‡∏¢‡∏∏‡∏†‡∏±‡∏Å‡∏©‡πå‡∏Æ‡∏≠‡∏•‡∏•‡πå ‡∏£‡∏£.‡πÄ‡∏ã‡πá‡∏ô‡∏ó‡∏≤‡∏£‡∏≤ ‡πÑ‡∏•‡∏ü‡πå ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡∏Ø ‡πÅ‡∏à‡πâ‡∏á‡∏ß‡∏±‡∏í‡∏ô‡∏∞", startDate: new Date("2025-12-28T08:30:00"), endDate: new Date("2025-12-31T16:00:00") },
            { dateText: "7 ‡∏°.‡∏Ñ. 69", title: "‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£", desc: "‡∏ó‡∏±‡πâ‡∏á‡πÅ‡∏ö‡∏ö‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏Ç‡∏ï ‡πÅ‡∏•‡∏∞‡πÅ‡∏ö‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠", startDate: new Date("2026-01-07T00:00:00"), endDate: new Date("2026-01-07T23:59:59") },
            { dateText: "18 ‡∏°.‡∏Ñ. 69", title: "‡πÅ‡∏à‡πâ‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå", desc: "‡∏ô‡∏≤‡∏¢‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏à‡πâ‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏à‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô", startDate: new Date("2026-01-18T00:00:00"), endDate: new Date("2026-01-18T23:59:59") },
            { dateText: "28 ‡∏°.‡∏Ñ. 69", title: "‡∏ß‡∏±‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠-‡∏ñ‡∏≠‡∏ô‡∏ä‡∏∑‡πà‡∏≠", desc: "‡∏¢‡∏∑‡πà‡∏ô‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡∏≠‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á", startDate: new Date("2026-01-28T00:00:00"), endDate: new Date("2026-01-28T23:59:59") },
            { dateText: "1 ‡∏Å.‡∏û. 69", title: "‡∏ß‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤", desc: "(08.00-17.00 ‡∏ô.) ‡∏ó‡∏±‡πâ‡∏á‡πÉ‡∏ô/‡∏ô‡∏≠‡∏Å‡πÄ‡∏Ç‡∏ï ‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏û‡∏¥‡∏Å‡∏≤‡∏£/‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏", startDate: new Date("2026-02-01T08:00:00"), endDate: new Date("2026-02-01T17:00:00") },
            { dateText: "1-7 ‡∏Å.‡∏û. 69", title: "‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡πÑ‡∏°‡πà‡∏≠‡∏≤‡∏à‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (‡∏£‡∏≠‡∏ö 1)", desc: "‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ 7 ‡∏ß‡∏±‡∏ô ‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á", startDate: new Date("2026-02-01T00:00:00"), endDate: new Date("2026-02-07T23:59:59") },
            { dateText: "8 ‡∏Å.‡∏û. 69", title: "‚≠ê ‡∏ß‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á ‚≠ê", desc: "(08.00-17.00 ‡∏ô.) ‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô", startDate: new Date("2026-02-08T08:00:00"), endDate: new Date("2026-02-08T17:00:00") },
            { dateText: "9-15 ‡∏Å.‡∏û. 69", title: "‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡πÑ‡∏°‡πà‡∏≠‡∏≤‡∏à‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (‡∏£‡∏≠‡∏ö 2)", desc: "‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ 7 ‡∏ß‡∏±‡∏ô ‡∏´‡∏•‡∏±‡∏á‡∏ß‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á", startDate: new Date("2026-02-09T00:00:00"), endDate: new Date("2026-02-15T23:59:59") }
        ];

        const units = [
            { id: 1, name: "‡∏•‡∏≤‡∏ô‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡∏ï‡∏•‡∏≤‡∏î‡∏¢‡∏≤‡∏™‡∏π‡∏ö", name_details: "‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡πÉ‡∏Å‡∏•‡πâ‡∏™‡∏´‡∏†‡∏≤‡∏û‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô", unit_count: "3 ‡∏´‡∏ô‡πà‡∏ß‡∏¢", lat: 13.724167, lng: 100.554444, images: ["https://placehold.co/400x300/orange/white?text=‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà1"], details_range: "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà 1-3", location_type: "‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£", note: "‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà" },
            { id: 2, name: "‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏±‡∏î‡∏Ñ‡∏•‡∏≠‡∏á‡πÄ‡∏ï‡∏¢", name_details: "‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 1 ‡∏ä‡∏±‡πâ‡∏ô‡∏•‡πà‡∏≤‡∏á", unit_count: "1 ‡∏´‡∏ô‡πà‡∏ß‡∏¢", lat: 13.718500, lng: 100.559200, images: [], details_range: "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà 4", location_type: "‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£", note: "-" },
            { id: 3, name: "‡∏ß‡∏±‡∏î‡∏™‡∏∞‡∏û‡∏≤‡∏ô", name_details: "‡∏•‡∏≤‡∏ô‡∏ß‡∏±‡∏î", unit_count: "2 ‡∏´‡∏ô‡πà‡∏ß‡∏¢", lat: 13.710000, lng: 100.590000, images: [], details_range: "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà 5-6", location_type: "‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£", note: "-" }
        ];

        let map, markers = [];

        // --- RESPONSIVE LOGIC ---
        function checkResponsive() {
            const isDesktop = window.innerWidth >= 1024;
            
            // ‡∏™‡∏•‡∏±‡∏ö Class ‡∏ó‡∏µ‡πà Body
            if (isDesktop) {
                document.body.classList.remove('mobile-mode');
                // Desktop: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Font ‡∏Ñ‡∏á‡∏ó‡∏µ‡πà ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á Scale ‡∏ï‡∏≤‡∏°‡∏à‡∏≠
                document.documentElement.style.fontSize = '10px';
                // Desktop: ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ Map ‡∏ß‡∏≤‡∏î‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡∏à‡∏≠
                if (map) setTimeout(() => map.invalidateSize(), 100);
            } else {
                document.body.classList.add('mobile-mode');
                // Mobile: ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Scale
                adjustGameScaling();
            }
        }

        function adjustGameScaling() {
            // ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Mobile Mode
            if (window.innerWidth >= 1024) return;

            const gameFrame = document.querySelector('.game-frame');
            if (!gameFrame) return;
            const designWidth = 960;
            const currentWidth = gameFrame.offsetWidth;
            const scaleRatio = currentWidth / designWidth;
            document.documentElement.style.fontSize = `${10 * scaleRatio}px`;
            if(map) setTimeout(() => map.invalidateSize(), 300);
        }

        // --- TAB SYSTEM (Mobile) ---
        function switchTab(tabId, btn) {
            if (window.innerWidth >= 1024) return; // Desktop ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏î Tab

            if(btn) { document.querySelectorAll('.nav-tab').forEach(b => b.classList.remove('active')); btn.classList.add('active'); }
            document.querySelectorAll('.tab-view').forEach(v => v.classList.remove('active'));
            document.getElementById('view-' + tabId).classList.add('active');
            if(tabId === 'map' && map) setTimeout(() => map.invalidateSize(), 100);
        }

        // --- LOGIC: MAP & TIMELINE ---
        function initTimeline() {
            const container = document.getElementById('timeline-container');
            const now = new Date();
            let html = '';
            timelineData.forEach(item => {
                let statusClass = now > item.endDate ? 't-status-done' : (now >= item.startDate ? 't-status-active' : 't-status-future');
                let icon = now > item.endDate ? '‚úì' : (now >= item.startDate ? 'üî•' : 'üîí');
                let titleStyle = statusClass === 't-status-active' ? 'color:#FF9800;' : '';

                html += `
                    <div class="timeline-item ${statusClass}">
                        <div class="t-circle">${icon}</div>
                        <div class="t-content">
                            <span class="t-date">${item.dateText}</span>
                            <h3 style="${titleStyle}">${item.title}</h3>
                            ${item.desc ? `<p>${item.desc}</p>` : ''}
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function initMap() {
            map = L.map('map', { zoomControl: true }).setView([13.720, 100.555], 14);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', { attribution: '¬©OpenStreetMap', maxZoom: 19 }).addTo(map);
            renderMarkers(units);
        }

        function renderMarkers(data) {
            markers.forEach(m => map.removeLayer(m));
            markers = [];
            data.forEach(unit => {
                let typeColor = unit.location_type.includes("‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å") ? "red" : "blue";
                let customIcon = L.divIcon({
                    className: 'custom-pin',
                    html: `<div style="background-color: ${typeColor === 'red' ? '#FF6B6B' : '#4ECDC4'}; width: 3rem; height: 3rem; border-radius: 50%; border: 0.3rem solid white; box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.3); display: flex; justify-content: center; align-items: center; font-size: 1.5rem;">${typeColor === 'red' ? '‚òÄÔ∏è' : 'üè¢'}</div>`,
                    iconSize: [30, 30], iconAnchor: [15, 15]
                });
                markers.push(L.marker([unit.lat, unit.lng], { icon: customIcon }).addTo(map).on('click', () => openPopup(unit)));
            });
        }

        function filterMap(type, btn) {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active');
            renderMarkers(type === 'all' ? units : units.filter(u => u.location_type.includes(type === 'out' ? "‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å" : "‡∏†‡∏≤‡∏¢‡πÉ‡∏ô")));
        }

        function openPopup(data) {
            document.getElementById('p-name').innerText = data.name;
            document.getElementById('p-sub').innerText = data.name_details;
            document.getElementById('p-unit').innerText = data.unit_count;
            document.getElementById('p-note').innerText = data.note;
            const typeBadge = document.getElementById('p-type');
            typeBadge.className = data.location_type.includes("‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å") ? "badge badge-out" : "badge badge-in";
            typeBadge.innerText = data.location_type.includes("‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å") ? "‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£" : "‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£";
            const gallery = document.getElementById('p-gallery');
            gallery.innerHTML = data.images.length ? data.images.map(img => `<img src="${img}" onclick="window.open('${img}')">`).join('') : `<div style="width:100%; height:10rem; background:#eee; border-radius:1.5rem; display:flex; justify-content:center; align-items:center; color:#999; font-size:1.6rem;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</div>`;
            document.getElementById('info-overlay').classList.add('visible');
        }

        function closePopup(e) { if (e.target.id === 'info-overlay') closePopupDirect(); }
        function closePopupDirect() { document.getElementById('info-overlay').classList.remove('visible'); }

        // --- INIT ---
        window.addEventListener('load', () => { 
            checkResponsive();
            initTimeline();
            initMap();
        });
        window.addEventListener('resize', checkResponsive);

    </script>
</body>
</html>
